
;DECLARACIÓN DE BITS
TG		EQU		0X00	;TIGER PIN0
EC		EQU		0X01	;ECHO PIN1
LED		EQU		0X02	;LED PIN2
RP0		EQU		0X05
RP1		EQU		0X06
	
;DECLARACIÓN DE VARIABLES
DIS		EQU		0X30
CONT	EQU		0X20	
TIME11 	EQU 	0X21
TIME12	EQU		0X22
TIME13	EQU		0X23
							;VARIABLES PARA 
TIME21 	EQU 	0X24		;LAS SUBRUTINAS
TIME22	EQU		0X25		;DE TIEMPO
TIME23	EQU		0X26

TIME31 	EQU 	0X27
TIME32	EQU		0X28
TIME33	EQU		0X29

; DECLARACIÓN DE REGISTRO 

STATUS	EQU		0X03
PORTC	EQU		0X07
TRISC	EQU		0X87	
ANSELH	EQU		0X189

		ORG		0X00
		GOTO	INI
		ORG		0X20
INI	
		CLRF	DIS
		CLRF	CONT
		MOVLW	d'10'	;VALOR DE LOS CENTIMETROS, EN ESTE CASO 10CM
		MOVWF	DIS		;MOVERLO A LA VARIABLE DIS
		CLRF	PORTC
		BSF		STATUS,RP0	;CAMBIAR AL BANCO 1	
		MOVLW	b'00000010'
		MOVWF	TRISC		;ENTRADA PIN1 DEL TRISC, LAS DEMAS COMO SALIDA
		BSF		STATUS,RP1	;CAMBIAR AL BANCO 3
		CLRF	ANSELH		;CONFIGURA COMO DIGITAL
		BCF		STATUS,RP0
		BCF		STATUS,RP1
VOLVER	
		CALL	_65MILI		;TIEMPO DE ESPERA QUE RECOMOENDA EL FABRICANTE
		BSF		PORTC,TG	;MANDARLO POR EL PORTC EN EL TIGER
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP			
		NOP
		NOP
		NOP				;PULSO DE 17US
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP
		NOP
		BCF	PORTC,TG
		
		;ANALIZAR EL TIEMPO DE ECHO
A_ECHO		
		BTFSS	PORTC,EC	;PREGUNTA SI HAY UN 1 EN LA SEÑAL DE ENTRADA ECHO
		GOTO	A_ECHO		;SI HAY 0, VUELVE A PREGUNTAR
		GOTO	CALCULAR	;SI HAY UN 1, VA A CALCULAR 
CALCULAR
		CLRF	CONT		;LIMPIAMOS EL VALOR DEL CONTEO
MEDIR_DIS
		CALL	_55US		;MANDAMOS UN RETARDO DE 55 MICROSEGUNDOS
		INCF	CONT,F		;INCREMENTAMOS 									;JUNTO CON  
		BTFSS	PORTC,EC	;PREGUNTA SI ES 1 EL PUERTO DEL ECHO			; ESTAS INSTRUCCIONES
		GOTO	COMPARAR	;SI ES 0, VA A COMPARAR							;ACUMULAMOS
		GOTO	MEDIR_DIS	;SI ES 1, VUELVE A MEDIAR						;60 US

;AQUI SE VA A COMPARAR EL VALOR DEL CONTADOR VS EL VALOR DE LA
;DISTANCIA PREVIAMENTE ESTABLECIDA POR EL USUARIO
		
COMPARAR
		MOVF	CONT,W		;MOVEMOS EL VALOR DEL CONTADOR A W
		SUBWF	DIS			;COMPARAMOS CON EL VALOR ESTABLECIDO DE LA DISTANCIA, 10CM
		BTFSC	STATUS,0	;PREGUNTA SI EL CARRY DEL STATUS ES 0
		GOTO	LED_ON		;SI ES 1, LA RESTA TIENE UN RESULTADO POSITIVO POR LO TANTO ESTA DENTRO DEL RANGO DONDE DEVE ENCENDER EL LED
		GOTO	VOLVER		;SI ES 0, VUELVE A HACER LA MEDICIÓN 
		
LED_ON
		BSF		PORTC,LED	;ENCIENDE EL LED
		GOTO	VOLVER		;VUELVE A HACER LA MEDICIÓN
;****************55MICRO************
_55US
		MOVLW	.1
		MOVWF	TIME21
TRES1	
		MOVLW	.2
		MOVWF	TIME22
DOS1	
		MOVLW	.5
		MOVWF	TIME23
UNO1
		NOP
		DECFSZ	TIME23
GOTO	UNO1
		DECFSZ	TIME22
GOTO	DOS1
		DECFSZ	TIME21
GOTO	TRES1

RETURN




;****************65MILI************
_65MILI
		MOVLW	.4
		MOVWF	TIME11
TRES	
		MOVLW	.100
		MOVWF	TIME12
DOS	
		MOVLW	.40
		MOVWF	TIME13
UNO
		NOP
		DECFSZ	TIME13
GOTO	UNO
		DECFSZ	TIME12
GOTO	DOS
		DECFSZ	TIME11
GOTO	TRES

RETURN


	END
		
